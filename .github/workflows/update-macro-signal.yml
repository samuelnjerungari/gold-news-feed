name: Auto-update macro signal

on:
  schedule:
    - cron: '*/15 * * * *'   # Increased frequency to 15 mins
  workflow_dispatch:         # Allows you to click "Run Now" manually

permissions:
  contents: write

jobs:
  update-macro:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'       # âœ… Caches libraries so runs are faster (saves ~30s)

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          # Added 'lxml' which is often needed for yfinance/feedparser scraping
          pip install requests feedparser vaderSentiment yfinance pandas lxml

      - name: Run macro script
        run: python update_macro_signal.py

      - name: Commit & push if changed
        run: |
          git config user.name "MacroBot"
          git config user.email "actions@github.com"
          git add macro_signal.csv
          # Check if there are changes before committing to avoid empty commit errors
          if [[ -n $(git status -s macro_signal.csv) ]]; then
            git commit -m "Signal Update: $(date -u +'%H:%M UTC')"
            git push
          else
            echo "No change in signal. Skipping commit."
          fi
